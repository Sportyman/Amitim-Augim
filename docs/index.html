<!DOCTYPE html>
<html lang="he" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Amitim Activity Finder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'Assistant', sans-serif;
      }
    </style>
    <!-- Babel Standalone for live transpilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="importmap">
    {
      "imports": {
        "react": "https://aistudiocdn.com/react@^18.2.0",
        "react-dom/client": "https://aistudiocdn.com/react-dom@^18.2.0/client",
        "@google/genai": "https://aistudiocdn.com/@google/genai@^1.29.1"
      }
    }
    </script>
  </head>
  <body class="bg-gray-50">
    <div id="root"></div>
    <script type="text/babel" data-type="module">
      import React, { useState, useEffect, useCallback, useMemo } from 'react';
      import ReactDOM from 'react-dom/client';
      import { GoogleGenAI, Type } from "@google/genai";

      // --- Inlined: components/icons.tsx ---
      const SportIcon = ({ className }) => (
        <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <circle cx="12" cy="12" r="10" />
          <path d="m3.5 9 17 6" />
          <path d="m20.5 9-17 6" />
          <path d="M12 2v20" />
        </svg>
      );
      const ArtIcon = ({ className }) => (
        <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <path d="M12 20h.01" /><path d="M11 6.16A5.32 5.32 0 0 1 12 6a5.32 5.32 0 0 1 1-.16" /><path d="M12 6h.01" /><path d="M16 4.01" /><path d="M17.5 7.5a2.5 2.5 0 0 1 0-5" /><path d="M21.5 9.5a2.5 2.5 0 0 1 0-5" /><path d="M6.5 7.5a2.5 2.5 0 0 0 0-5" /><path d="M2.5 9.5a2.5 2.5 0 0 0 0-5" /><path d="M12 12a5.32 5.32 0 0 1-.16 1" /><path d="M12 18a5.32 5.32 0 0 1-.16 1" /><path d="m14 18 4-4" /><path d="M18 10V2" /><path d="M6 18l-4-4" /><path d="M2 10v8" />
        </svg>
      );
      const MusicIcon = ({ className }) => (
          <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
              <path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/>
          </svg>
      );
      const GoldenAgeIcon = ({ className }) => (
          <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
              <circle cx="12" cy="12" r="10" /><path d="M12 12 L12 6" /><path d="M12 12 L16 14" /><path d="M12 12 L8 14" />
          </svg>
      );
      const EnrichmentIcon = ({ className }) => (
          <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
              <path d="M4 19.5 A2.5 2.5 0 0 1 6.5 17 H 20" /><path d="M6.5 2 H 20 v 15 H 6.5 A 2.5 2.5 0 0 1 4 14.5 v -10 A 2.5 2.5 0 0 1 6.5 2 Z" />
          </svg>
      );
      const CommunityIcon = ({ className }) => (
          <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
              <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" /><circle cx="8.5" cy="7" r="4" /><path d="M20 8v6" /><path d="M23 11h-6" />
          </svg>
      );
      const TechIcon = ({ className }) => (
        <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
            <rect width="18" height="12" x="3" y="4" rx="2" ry="2"/><line x1="2" x2="22" y1="20" y2="20"/><line x1="12" x2="12" y1="16" y2="20"/>
        </svg>
      );
      const SearchIcon = ({ className }) => (
        <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
      );
      const UsersIcon = ({ className }) => (
        <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" /><circle cx="9" cy="7" r="4" /><path d="M22 21v-2a4 4 0 0 0-3-3.87" /><path d="M16 3.13a4 4 0 0 1 0 7.75" />
        </svg>
      );
      const ClockIcon = ({ className }) => (
        <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <circle cx="12" cy="12" r="10" /><polyline points="12 6 12 12 16 14" />
        </svg>
      );
      const GridIcon = ({ className }) => (
        <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <rect x="3" y="3" width="7" height="7" /><rect x="14" y="3" width="7" height="7" /><rect x="3" y="14" width="7" height="7" /><rect x="14" y="14" width="7" height="7" />
        </svg>
      );
      const ListIcon = ({ className }) => (
        <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <line x1="8" y1="6" x2="21" y2="6" /><line x1="8" y1="12" x2="21" y2="12" /><line x1="8" y1="18" x2="21" y2="18" /><line x1="3" y1="6" x2="3.01" y2="6" /><line x1="3" y1="12" x2="3.01" y2="12" /><line x1="3" y1="18" x2="3.01" y2="18" />
        </svg>
      );
      const SlidersIcon = ({ className }) => (
        <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <line x1="4" y1="21" x2="4" y2="14" /><line x1="4" y1="10" x2="4" y2="3" /><line x1="12" y1="21" x2="12" y2="12" /><line x1="12" y1="8" x2="12" y2="3" /><line x1="20" y1="21" x2="20" y2="16" /><line x1="20" y1="12" x2="20" y2="3" /><line x1="1" y1="14" x2="7" y2="14" /><line x1="9" y1="8" x2="15" y2="8" /><line x1="17" y1="16" x2="23" y2="16" />
        </svg>
      );
      const ChevronDownIcon = ({ className }) => (
          <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
              <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
      );
      const ChevronUpIcon = ({ className }) => (
          <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
              <polyline points="18 15 12 9 6 15"></polyline>
          </svg>
      );
       const LocationIcon = ({ className }) => (
          <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle>
          </svg>
      );
      
      // --- Inlined: constants.ts ---
      const CATEGORIES = [
        { id: 'sport', name: 'ספורט', icon: SportIcon },
        { id: 'art', name: 'אומנות', icon: ArtIcon },
        { id: 'music', name: 'מוזיקה', icon: MusicIcon },
        { id: 'golden_age', name: 'גיל הזהב', icon: GoldenAgeIcon },
        { id: 'enrichment', name: 'העשרה ולימוד', icon: EnrichmentIcon },
        { id: 'community', name: 'קהילה', icon: CommunityIcon },
        { id: 'tech', name: 'טכנולוגיה', icon: TechIcon },
      ];

      // --- Inlined: services/geminiService.ts ---
      const ai = new GoogleGenAI({ apiKey: process.env.API_KEY });

      const findRelatedKeywords = async (term) => {
        if (!term.trim()) return [];
        try {
          const prompt = `For the search term "${term}" on a Hebrew activity finder website, provide related keywords. For example, for "בריכה", suggest "שחייה", "מים", "קאנטרי". Return a JSON object where the key "keywords" is an array of Hebrew keyword strings.`;
          const response = await ai.models.generateContent({
            model: 'gemini-2.5-flash',
            contents: prompt,
            config: {
              responseMimeType: "application/json",
              responseSchema: {
                type: Type.OBJECT,
                properties: { keywords: { type: Type.ARRAY, items: { type: Type.STRING } } }
              }
            }
          });
          const jsonString = response.text.trim();
          if(jsonString) {
              const result = JSON.parse(jsonString);
              if (result && Array.isArray(result.keywords)) return result.keywords;
          }
          return [];
        } catch (error) {
          console.error("Error fetching related keywords from Gemini API:", error);
          return [];
        }
      };
      
      const scrapeAndStructureData = async (html) => {
        if (!html.trim()) {
          throw new Error("HTML input is empty.");
        }
      
        const prompt = `
          Analyze the provided HTML content from a Hebrew website listing activities.
          Extract the details for each activity and structure them into a JSON array of objects.
          Each object should represent one activity and must conform to the following structure:
          - id: A unique number for the activity. Generate this sequentially starting from 1.
          - title: The name of the activity (string).
          - category: The category of the activity (string). Map it to one of the following categories if possible: ספורט, אומנות, מוזיקה, גיל הזהב, העשרה ולימוד, קהילה, טכנולוגיה. Otherwise, use the category found in the HTML.
          - description: A brief summary of the activity (string).
          - imageUrl: The full URL for the activity's image (string). Resolve relative URLs if needed.
          - location: The location, including community center and city, e.g., "מרכז קהילתי נווה ארזים, תל אביב" (string).
          - price: The price of the activity (number). If it's free or not mentioned, use 0.
          - ageGroup: The target age group, e.g., "גילאי 6-8" (string).
          - schedule: The days and times of the activity, e.g., "ימי שני, 17:00-18:00" (string).
          - instructor: The instructor's name (string). If not available, the value should be null.
          - detailsUrl: The full URL to the details page for the activity (string). Resolve relative URLs if needed.
      
          Return only the raw JSON string. Do not wrap it in markdown backticks or any other text.
      
          HTML Content to parse:
          ${html}
        `;
      
        try {
          const response = await ai.models.generateContent({
            model: 'gemini-2.5-pro',
            contents: prompt,
            config: {
              responseMimeType: "application/json",
              responseSchema: {
                type: Type.ARRAY,
                items: {
                  type: Type.OBJECT,
                  properties: {
                    id: { type: Type.INTEGER },
                    title: { type: Type.STRING },
                    category: { type: Type.STRING },
                    description: { type: Type.STRING },
                    imageUrl: { type: Type.STRING },
                    location: { type: Type.STRING },
                    price: { type: Type.NUMBER },
                    ageGroup: { type: Type.STRING },
                    schedule: { type: Type.STRING },
                    instructor: { type: Type.STRING },
                    detailsUrl: { type: Type.STRING }
                  },
                  required: ['id', 'title', 'category', 'description', 'imageUrl', 'location', 'price', 'ageGroup', 'schedule', 'instructor', 'detailsUrl']
                }
              }
            }
          });
      
          const jsonString = response.text.trim();
          if (jsonString) {
            try {
              JSON.parse(jsonString);
              return jsonString;
            } catch (e) {
              console.error("Gemini API returned invalid JSON:", jsonString);
              throw new Error("Gemini API returned invalid JSON.");
            }
          }
          throw new Error("Received empty response from Gemini API.");
      
        } catch (error) {
          console.error("Error scraping data with Gemini API:", error);
          if (error instanceof Error) {
              throw new Error(`Failed to scrape and structure data: ${error.message}`);
          }
          throw new Error("An unknown error occurred during data scraping.");
        }
      };


      // --- Inlined Components ---
      const Header = () => (
        <header className="bg-white shadow-sm sticky top-0 z-10">
          <div className="container mx-auto px-4 sm:px-6 lg:px-8">
            <div className="flex items-center justify-between h-16">
              <div className="flex-shrink-0">
                <a href="/" className="text-2xl font-bold text-orange-500">עמיתים</a>
              </div>
              <div className="hidden md:flex md:items-center md:space-x-8 md:rtl:space-x-reverse">
                <a href="#" className="text-gray-500 hover:text-gray-700">חוגים</a>
                <a href="#" className="text-gray-500 hover:text-gray-700">סדנאות</a>
                <a href="#" className="text-gray-500 hover:text-gray-700">טיולים</a>
                <a href="#" className="text-gray-500 hover:text-gray-700">הרצאות</a>
              </div>
              <div className="flex items-center">
                <a href="#" className="bg-orange-500 text-white px-4 py-2 rounded-full hover:bg-orange-600 transition-colors duration-300">הוספה לאתר</a>
              </div>
            </div>
          </div>
        </header>
      );

      const CategoryFilter = ({ categories, selectedCategories, onCategoryToggle }) => (
        <div className="flex justify-center flex-wrap gap-4 sm:gap-6">
          {categories.map((category) => {
            const isSelected = selectedCategories.includes(category.id);
            const Icon = category.icon;
            return (
              <div key={category.id} className="flex flex-col items-center gap-2">
                <button
                  onClick={() => onCategoryToggle(category.id)}
                  className={`w-20 h-20 sm:w-24 sm:h-24 rounded-full flex items-center justify-center transition-all duration-300 border-2 ${isSelected ? 'bg-orange-100 border-orange-500 scale-105' : 'bg-white border-gray-300 hover:border-orange-400'}`}
                >
                  <Icon className={`w-8 h-8 sm:w-10 sm:h-10 transition-colors duration-300 ${isSelected ? 'text-orange-500' : 'text-gray-500'}`} />
                </button>
                <span className={`text-sm sm:text-base font-semibold ${isSelected ? 'text-orange-600' : 'text-gray-700'}`}>{category.name}</span>
              </div>
            );
          })}
        </div>
      );

      const SearchBar = ({ searchTerm, onSearchChange, onSubmit, isLoading }) => {
        const handleKeyDown = (e) => {
          if (e.key === 'Enter') onSubmit();
        };
        return (
          <div className="relative w-full max-w-lg mx-auto">
            <input type="text" placeholder="חיפוש חופשי..." value={searchTerm} onChange={(e) => onSearchChange(e.target.value)} onKeyDown={handleKeyDown} className="w-full px-5 py-3 pr-12 text-lg text-gray-700 bg-white border-2 border-gray-300 rounded-full focus:outline-none focus:border-orange-500 transition-colors duration-300" />
            <button onClick={onSubmit} disabled={isLoading} className="absolute inset-y-0 right-0 flex items-center justify-center w-14 text-gray-400 hover:text-orange-500 disabled:text-gray-300 disabled:cursor-not-allowed">
              {isLoading ? (
                  <svg className="animate-spin h-5 w-5 text-orange-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                      <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                      <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                  </svg>
              ) : ( <SearchIcon className="w-6 h-6" /> )}
            </button>
          </div>
        );
      };

      const ActivityCard = ({ activity }) => {
        const getKeywords = () => {
          let titleKeywords = activity.title.split('-')[0].trim();
          return `${titleKeywords},${activity.category}`;
        };
        const unsplashUrl = `https://source.unsplash.com/400x300/?${encodeURIComponent(getKeywords())}`;
        const fallbackUrl = `https://picsum.photos/seed/${activity.id}/400/300`;
        const handleImageError = (e) => {
          if (e.currentTarget.src !== fallbackUrl) e.currentTarget.src = fallbackUrl;
        };
        return (
          <div className="bg-white rounded-lg shadow-md overflow-hidden transform hover:-translate-y-1 transition-all duration-300 flex flex-col">
            <img className="w-full h-32 object-cover" src={unsplashUrl} onError={handleImageError} alt={activity.title} />
            <div className="p-3 flex flex-col flex-grow">
              <div className="flex justify-between items-start">
                  <span className="text-xs text-orange-500 font-semibold bg-orange-100 px-2 py-1 rounded-full">{activity.category}</span>
                  <div className="text-base font-bold text-green-600 flex items-center">
                      <span>{activity.price} ₪</span>
                  </div>
              </div>
              <h3 className="mt-1 text-base font-bold text-gray-800 flex-grow">{activity.title}</h3>
              <div className="mt-2 space-y-1 text-xs text-gray-600">
                  <div className="flex items-center">
                      <LocationIcon className="w-4 h-4 ml-2 text-gray-400 flex-shrink-0" />
                      <span className="truncate">{activity.location}</span>
                  </div>
                  <div className="flex items-center">
                      <UsersIcon className="w-4 h-4 ml-2 text-gray-400 flex-shrink-0" />
                      <span className="truncate">{activity.ageGroup}</span>
                  </div>
                  <div className="flex items-center">
                      <ClockIcon className="w-4 h-4 ml-2 text-gray-400 flex-shrink-0" />
                      <span className="truncate">{activity.schedule}</span>
                  </div>
              </div>
              <div className="mt-3 pt-3 border-t border-gray-100">
                  <a href={activity.detailsUrl} target="_blank" rel="noopener noreferrer" className="w-full text-center bg-orange-500 text-white px-3 py-2 rounded-full hover:bg-orange-600 transition-colors duration-300 block font-semibold text-sm">לפרטים נוספים</a>
              </div>
            </div>
          </div>
        );
      };

      const ActivityListItem = ({ activity }) => {
        const getKeywords = () => {
          let titleKeywords = activity.title.split('-')[0].trim();
          return `${titleKeywords},${activity.category}`;
        };
        const unsplashUrl = `https://source.unsplash.com/400x300/?${encodeURIComponent(getKeywords())}`;
        const fallbackUrl = `https://picsum.photos/seed/${activity.id}/400/300`;
        const handleImageError = (e) => {
          if (e.currentTarget.src !== fallbackUrl) e.currentTarget.src = fallbackUrl;
        };
        return (
          <div className="bg-white rounded-lg shadow-md overflow-hidden transition-all duration-300 flex flex-col sm:flex-row hover:shadow-lg">
            <img className="w-full h-40 sm:w-48 sm:h-auto object-cover" src={unsplashUrl} onError={handleImageError} alt={activity.title} />
            <div className="p-4 flex flex-col flex-grow justify-between">
              <div>
                  <div className="flex justify-between items-start">
                      <h3 className="text-lg font-bold text-gray-800">{activity.title}</h3>
                      <div className="text-lg font-bold text-green-600 flex items-center flex-shrink-0 ml-4">
                          <span>{activity.price} ₪</span>
                      </div>
                  </div>
                  <span className="text-xs text-orange-500 font-semibold bg-orange-100 px-2 py-1 rounded-full">{activity.category}</span>
                  <div className="mt-3 grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-2 text-sm text-gray-600">
                      <div className="flex items-center">
                          <LocationIcon className="w-4 h-4 ml-2 text-gray-400" />
                          <span>{activity.location}</span>
                      </div>
                      <div className="flex items-center">
                          <UsersIcon className="w-4 h-4 ml-2 text-gray-400" />
                          <span>{activity.ageGroup}</span>
                      </div>
                      <div className="flex items-center col-span-1 md:col-span-2">
                          <ClockIcon className="w-4 h-4 ml-2 text-gray-400" />
                          <span>{activity.schedule}</span>
                      </div>
                  </div>
              </div>
              <div className="mt-4 pt-3 border-t border-gray-100 text-left">
                  <a href={activity.detailsUrl} target="_blank" rel="noopener noreferrer" className="inline-block bg-orange-500 text-white px-5 py-2 rounded-full hover:bg-orange-600 transition-colors duration-300 font-semibold text-sm">לפרטים נוספים</a>
              </div>
            </div>
          </div>
        );
      };
      
      const ViewSwitcher = ({ currentView, onViewChange }) => {
        const baseClasses = "p-2 rounded-md transition-colors duration-200";
        const activeClasses = "bg-orange-100 text-orange-600";
        const inactiveClasses = "text-gray-400 hover:bg-gray-100 hover:text-gray-600";
        return (
          <div className="flex items-center space-x-1 rtl:space-x-reverse bg-gray-100 rounded-lg p-1">
            <button onClick={() => onViewChange('grid')} className={`${baseClasses} ${currentView === 'grid' ? activeClasses : inactiveClasses}`} aria-label="Grid View" title="תצוגת רשת">
              <GridIcon className="w-5 h-5" />
            </button>
            <button onClick={() => onViewChange('list')} className={`${baseClasses} ${currentView === 'list' ? activeClasses : inactiveClasses}`} aria-label="List View" title="תצוגת רשימה">
              <ListIcon className="w-5 h-5" />
            </button>
          </div>
        );
      };

      const MultiSelectFilter = ({ title, options, selectedOptions, onToggle }) => {
        if (options.length <= 1) return null;
        return (
          <div>
            <h3 className="text-lg font-semibold text-gray-800 mb-3">{title}</h3>
            <div className="flex flex-wrap gap-2">
              {options.map((option) => {
                const isSelected = selectedOptions.includes(option);
                return (
                  <button key={option} onClick={() => onToggle(option)} className={`px-3 py-1.5 text-sm font-medium rounded-full border transition-colors duration-200 ${isSelected ? 'bg-blue-500 text-white border-blue-500' : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-100 hover:border-gray-400'}`}>
                    {option}
                  </button>
                );
              })}
            </div>
          </div>
        );
      };

      const AgeRangeFilter = ({ minAge, maxAge, onMinAgeChange, onMaxAgeChange }) => (
        <div>
          <h3 className="text-lg font-semibold text-gray-800 mb-3">סינון לפי טווח גילאים</h3>
          <div className="flex items-center gap-4 max-w-md">
            <div className="flex-1">
              <label htmlFor="min-age" className="block text-sm font-medium text-gray-700">מגיל</label>
              <input type="number" id="min-age" value={minAge} onChange={(e) => onMinAgeChange(e.target.value)} placeholder="לדוגמה: 7" className="mt-1 w-full px-3 py-2 text-base text-gray-700 bg-white border border-gray-300 rounded-md focus:outline-none focus:border-orange-500 transition-colors duration-300" min="0" aria-label="גיל מינימלי" />
            </div>
            <div className="flex-1">
              <label htmlFor="max-age" className="block text-sm font-medium text-gray-700">עד גיל</label>
              <input type="number" id="max-age" value={maxAge} onChange={(e) => onMaxAgeChange(e.target.value)} placeholder="לדוגמה: 12" className="mt-1 w-full px-3 py-2 text-base text-gray-700 bg-white border border-gray-300 rounded-md focus:outline-none focus:border-orange-500 transition-colors duration-300" min="0" aria-label="גיל מקסימלי" />
            </div>
          </div>
        </div>
      );

      const PriceRangeFilter = ({ minPrice, maxPrice, onMinPriceChange, onMaxPriceChange }) => (
        <div>
          <h3 className="text-lg font-semibold text-gray-800 mb-3">סינון לפי מחיר (₪)</h3>
          <div className="flex items-center gap-4 max-w-md">
            <div className="flex-1">
              <label htmlFor="min-price" className="block text-sm font-medium text-gray-700">מחיר מינימלי</label>
              <input type="number" id="min-price" value={minPrice} onChange={(e) => onMinPriceChange(e.target.value)} placeholder="לדוגמה: 100" className="mt-1 w-full px-3 py-2 text-base text-gray-700 bg-white border border-gray-300 rounded-md focus:outline-none focus:border-orange-500 transition-colors duration-300" min="0" aria-label="מחיר מינימלי" />
            </div>
            <div className="flex-1">
              <label htmlFor="max-price" className="block text-sm font-medium text-gray-700">מחיר מקסימלי</label>
              <input type="number" id="max-price" value={maxPrice} onChange={(e) => onMaxPriceChange(e.target.value)} placeholder="לדוגמה: 300" className="mt-1 w-full px-3 py-2 text-base text-gray-700 bg-white border border-gray-300 rounded-md focus:outline-none focus:border-orange-500 transition-colors duration-300" min="0" aria-label="מחיר מקסימלי" />
            </div>
          </div>
        </div>
      );

      const DataImporter = ({ currentActivities }) => {
        const [htmlInput, setHtmlInput] = useState('');
        const [jsonOutput, setJsonOutput] = useState('');
        const [isLoading, setIsLoading] = useState(false);
        const [error, setError] = useState('');

        const handleScrape = async () => {
          setIsLoading(true);
          setError('');
          setJsonOutput('');
          try {
            const result = await scrapeAndStructureData(htmlInput);
            const formattedResult = JSON.stringify(JSON.parse(result), null, 2);
            setJsonOutput(formattedResult);
          } catch (e) {
            setError(e.message || 'An unknown error occurred.');
          } finally {
            setIsLoading(false);
          }
        };

        const handleExport = () => {
          try {
              const dataStr = JSON.stringify(currentActivities, null, 2);
              const blob = new Blob([dataStr], { type: 'application/json;charset=utf-8' });
              const url = URL.createObjectURL(blob);
              const linkElement = document.createElement('a');
              linkElement.href = url;
              linkElement.download = 'activities_export.json';
              document.body.appendChild(linkElement);
              linkElement.click();
              document.body.removeChild(linkElement);
              URL.revokeObjectURL(url);
          } catch (err) {
              console.error("Failed to export data:", err);
              alert("שגיאה בעת ייצוא הנתונים. בדוק את הקונסול לפרטים.");
          }
        };

        return (
          <section className="bg-white p-6 rounded-lg shadow-md mb-12 border-2 border-dashed border-orange-300">
            <h2 className="text-2xl font-bold mb-4 text-gray-800">כלי ייבוא וייצוא נתונים (לאדמין בלבד)</h2>
            <p className="mb-4 text-gray-600">
              זהו כלי פיתוח זמני. כדי לעדכן חוגים, הדבק את קוד המקור המלא (View Page Source) של עמוד הפעילויות ולחץ על "חלץ נתונים".
            </p>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label htmlFor="htmlInput" className="block text-sm font-medium text-gray-700 mb-2">
                  הדבק קוד מקור HTML כאן:
                </label>
                <textarea
                  id="htmlInput"
                  value={htmlInput}
                  onChange={(e) => setHtmlInput(e.target.value)}
                  placeholder="<html>...</html>"
                  className="w-full h-64 p-3 border border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500 font-mono text-sm"
                />
              </div>
              <div>
                <label htmlFor="jsonOutput" className="block text-sm font-medium text-gray-700 mb-2">
                  תוצאת JSON (מוכנה להעתקה):
                </label>
                <textarea
                  id="jsonOutput"
                  readOnly
                  value={isLoading ? 'מעבד נתונים, אנא המתן...' : error ? `שגיאה: ${error}` : jsonOutput}
                  placeholder="[ { ... } ]"
                  className="w-full h-64 p-3 border border-gray-300 rounded-md bg-gray-50 font-mono text-sm"
                />
              </div>
            </div>
            <div className="mt-4 flex flex-col sm:flex-row gap-4">
              <button
                onClick={handleScrape}
                disabled={isLoading || !htmlInput}
                className="px-6 py-2 bg-orange-500 text-white font-semibold rounded-lg shadow-md hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors"
              >
                {isLoading ? (
                  <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white inline-block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                      <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                      <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                  </svg>
                ) : 'חלץ נתונים'}
              </button>
              <button
                onClick={handleExport}
                className="px-6 py-2 bg-blue-500 text-white font-semibold rounded-lg shadow-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"
              >
                ייצא נתונים נוכחיים (activities.json)
              </button>
            </div>
          </section>
        );
      };

      // --- Inlined: App.tsx ---
      const App = () => {
        const [activities, setActivities] = useState([]);
        const [isLoadingActivities, setIsLoadingActivities] = useState(true);
        const [searchTerm, setSearchTerm] = useState('');
        const [selectedCategories, setSelectedCategories] = useState([]);
        const [relatedKeywords, setRelatedKeywords] = useState([]);
        const [isSearching, setIsSearching] = useState(false);
        const [viewMode, setViewMode] = useState('grid');
        const [selectedCities, setSelectedCities] = useState([]);
        const [selectedLocations, setSelectedLocations] = useState([]);
        const [ageRange, setAgeRange] = useState({ min: '', max: '' });
        const [priceRange, setPriceRange] = useState({ min: '', max: '' });
        const [isAdvancedSearchOpen, setIsAdvancedSearchOpen] = useState(false);
        
        const parseAgeGroupToRange = (ageGroup) => {
          if (!ageGroup) return null;
          if (ageGroup.includes('רב גילאי')) return [0, 999];
          const olderMatch = ageGroup.match(/(\d+)\s*ומעלה/);
          if (olderMatch) return [parseInt(olderMatch[1], 10), 999];
          const rangeMatch = ageGroup.match(/(\d+)-(\d+)/);
          if (rangeMatch) return [parseInt(rangeMatch[1], 10), parseInt(rangeMatch[2], 10)];
          const singleNumberMatch = ageGroup.match(/\d+/);
          if (singleNumberMatch) { const age = parseInt(singleNumberMatch[0], 10); return [age, age]; }
          return null;
        };

        useEffect(() => {
          fetch('activities.json')
            .then(response => response.json())
            .then(data => {
              setActivities(data);
              setIsLoadingActivities(false);
            })
            .catch(error => {
              console.error("Error fetching activities:", error);
              setIsLoadingActivities(false);
            });
        }, []);

        const uniqueCities = useMemo(() => {
          const cities = activities.map(a => a.location.split(', ')[1]?.trim()).filter(Boolean);
          return [...new Set(cities)];
        }, [activities]);

        const uniqueLocations = useMemo(() => {
            const locations = activities.map(a => a.location.split(', ')[0]?.trim()).filter(Boolean);
            return [...new Set(locations)];
        }, [activities]);

        const handleCityToggle = (city) => setSelectedCities(prev => prev.includes(city) ? prev.filter(c => c !== city) : [...prev, city]);
        const handleLocationToggle = (location) => setSelectedLocations(prev => prev.includes(location) ? prev.filter(l => l !== location) : [...prev, location]);
        const handleMinAgeChange = (value) => setAgeRange(prev => ({ ...prev, min: value.replace(/[^0-9]/g, '') }));
        const handleMaxAgeChange = (value) => setAgeRange(prev => ({ ...prev, max: value.replace(/[^0-9]/g, '') }));
        const handleMinPriceChange = (value) => setPriceRange(prev => ({ ...prev, min: value.replace(/[^0-9]/g, '') }));
        const handleMaxPriceChange = (value) => setPriceRange(prev => ({ ...prev, max: value.replace(/[^0-9]/g, '') }));
        const handleCategoryToggle = (categoryId) => setSelectedCategories((prev) => prev.includes(categoryId) ? prev.filter((id) => id !== categoryId) : [...prev, categoryId]);

        const handleSearch = useCallback(async () => {
          if(!searchTerm) { setRelatedKeywords([]); return; }
          setIsSearching(true);
          const keywords = await findRelatedKeywords(searchTerm);
          setRelatedKeywords(keywords);
          setIsSearching(false);
        }, [searchTerm]);

        const filteredActivities = useMemo(() => {
          return activities.filter((activity) => {
            const categoryMatch = selectedCategories.length === 0 || selectedCategories.includes(CATEGORIES.find(c => c.name === activity.category)?.id || '');
            const searchKeywords = [searchTerm.toLowerCase(), ...relatedKeywords.map(k => k.toLowerCase())];
            const termMatch = searchTerm.trim() === '' || searchKeywords.some(keyword => 
                  activity.title.toLowerCase().includes(keyword) ||
                  activity.description.toLowerCase().includes(keyword) ||
                  activity.category.toLowerCase().includes(keyword)
            );
            const [locationName = '', cityName = ''] = activity.location.split(', ').map(s => s.trim());
            const cityMatch = selectedCities.length === 0 || selectedCities.includes(cityName);
            const locationMatch = selectedLocations.length === 0 || selectedLocations.includes(locationName);
            
            const ageGroupMatch = (() => {
              const { min: userMinText, max: userMaxText } = ageRange;
              if (userMinText === '' && userMaxText === '') return true;
              const userMin = userMinText !== '' ? parseInt(userMinText, 10) : 0;
              const userMax = userMaxText !== '' ? parseInt(userMaxText, 10) : 999;
              if (userMinText !== '' && userMaxText !== '' && userMin > userMax) return true;
              const activityRange = parseAgeGroupToRange(activity.ageGroup);
              if (!activityRange) return false;
              const [activityMin, activityMax] = activityRange;
              return activityMax >= userMin && activityMin <= userMax;
            })();
            
            const priceMatch = (() => {
              const { min: minPriceText, max: maxPriceText } = priceRange;
              if (minPriceText === '' && maxPriceText === '') return true;
              const minPrice = minPriceText !== '' ? parseInt(minPriceText, 10) : 0;
              const maxPrice = maxPriceText !== '' ? parseInt(maxPriceText, 10) : Infinity;
              return activity.price >= minPrice && activity.price <= maxPrice;
            })();

            return categoryMatch && termMatch && cityMatch && locationMatch && ageGroupMatch && priceMatch;
          });
        }, [selectedCategories, searchTerm, relatedKeywords, activities, selectedCities, selectedLocations, ageRange, priceRange]);

        const renderContent = () => {
          if (isLoadingActivities) {
              return (
                  <div className="text-center py-16">
                      <svg className="animate-spin h-8 w-8 text-orange-500 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                          <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                          <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                      </svg>
                      <p className="mt-4 text-gray-500">טוען פעילויות...</p>
                  </div>
              );
          }
          if (filteredActivities.length === 0) {
              return (
                  <div className="text-center py-16">
                      <h2 className="text-2xl font-semibold text-gray-700">לא נמצאו תוצאות</h2>
                      <p className="mt-2 text-gray-500">נסו לשנות את בחירת הקטגוריות או את מונח החיפוש.</p>
                  </div>
              );
          }
          if (viewMode === 'grid') {
            return (
                <div className="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 sm:gap-6">
                    {filteredActivities.map((activity) => (
                        <ActivityCard key={activity.id} activity={activity} />
                    ))}
                </div>
            );
          }
          return (
            <div className="space-y-4">
              {filteredActivities.map((activity) => (
                <ActivityListItem key={activity.id} activity={activity} />
              ))}
            </div>
          );
        };

        return (
          <div className="min-h-screen bg-gray-50 text-gray-800">
            <Header />
            <main>
              <div className="bg-gradient-to-br from-orange-50 to-rose-50">
                <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
                  <section className="text-center mb-12">
                    <h1 className="text-4xl sm:text-5xl font-extrabold text-gray-900 leading-tight">אז מה בא לך?</h1>
                    <p className="mt-4 text-lg text-gray-600 max-w-2xl mx-auto">גלו מגוון רחב של חוגים ופעילויות שמתאימים בדיוק לכם.</p>
                  </section>
                  <section className="mb-12 space-y-8">
                      <CategoryFilter categories={CATEGORIES} selectedCategories={selectedCategories} onCategoryToggle={handleCategoryToggle} />
                      <SearchBar searchTerm={searchTerm} onSearchChange={setSearchTerm} onSubmit={handleSearch} isLoading={isSearching} />
                      <div className="text-center">
                          <button onClick={() => setIsAdvancedSearchOpen(prev => !prev)} className="inline-flex items-center gap-2 px-4 py-2 text-sm font-semibold text-blue-600 bg-blue-100 rounded-full hover:bg-blue-200 transition-colors">
                              <SlidersIcon className="w-4 h-4" />
                              סינון מתקדם
                              {isAdvancedSearchOpen ? <ChevronUpIcon className="w-4 h-4"/> : <ChevronDownIcon className="w-4 h-4"/>}
                          </button>
                      </div>
                      <div className={`transition-all duration-500 ease-in-out overflow-hidden ${isAdvancedSearchOpen ? 'max-h-[1000px] opacity-100' : 'max-h-0 opacity-0'}`}>
                          <div className="bg-white p-6 rounded-lg shadow-sm mt-4 space-y-6">
                              <AgeRangeFilter minAge={ageRange.min} maxAge={ageRange.max} onMinAgeChange={handleMinAgeChange} onMaxAgeChange={handleMaxAgeChange} />
                              <PriceRangeFilter minPrice={priceRange.min} maxPrice={priceRange.max} onMinPriceChange={handleMinPriceChange} onMaxPriceChange={handleMaxPriceChange} />
                              <MultiSelectFilter title="סינון לפי עיר" options={uniqueCities} selectedOptions={selectedCities} onToggle={handleCityToggle} />
                              <MultiSelectFilter title="סינון לפי מרכז קהילתי" options={uniqueLocations} selectedOptions={selectedLocations} onToggle={handleLocationToggle} />
                          </div>
                      </div>
                  </section>
                </div>
              </div>
              <section className="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
                <div className="flex justify-between items-center mb-6">
                  <p className="text-gray-600">נמצאו <span className="font-bold text-orange-500">{filteredActivities.length}</span> תוצאות</p>
                  <ViewSwitcher currentView={viewMode} onViewChange={setViewMode} />
                </div>
                {renderContent()}
              </section>
              <section className="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
                <DataImporter currentActivities={activities} />
              </section>
            </main>
            <footer className="bg-white mt-16 py-6">
              <div className="text-center text-gray-500">&copy; {new Date().getFullYear()} Amitim Activity Finder. כל הזכויות שמורות.</div>
            </footer>
          </div>
        );
      };

      // --- Mount the application ---
      const rootElement = document.getElementById('root');
      const root = ReactDOM.createRoot(rootElement);
      root.render(<App />);
    </script>
  </body>
</html>